import{_ as i,M as l,p,q as d,R as n,N as s,V as t,t as e,a1 as c}from"./framework-bafc524a.js";const r={},u=n("h1",{id:"aiofiles-异步文件接口",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#aiofiles-异步文件接口","aria-hidden":"true"},"#"),e(" aiofiles 异步文件接口")],-1),k={href:"https://pypi.python.org/pypi/aiofiles",target:"_blank",rel:"noopener noreferrer"},h=n("img",{src:"https://img.shields.io/pypi/v/aiofiles.svg",alt:"",loading:"lazy"},null,-1),_={href:"https://travis-ci.org/Tinche/aiofiles",target:"_blank",rel:"noopener noreferrer"},f=n("img",{src:"https://travis-ci.org/Tinche/aiofiles.svg?branch=master",alt:"",loading:"lazy"},null,-1),y={href:"https://codecov.io/gh/Tinche/aiofiles",target:"_blank",rel:"noopener noreferrer"},g=n("img",{src:"https://codecov.io/gh/Tinche/aiofiles/branch/master/graph/badge.svg",alt:"",loading:"lazy"},null,-1),m={href:"https://github.com/Tinche/aiofiles",target:"_blank",rel:"noopener noreferrer"},w=n("img",{src:"https://img.shields.io/pypi/pyversions/aiofiles.svg",alt:"",loading:"lazy"},null,-1),b={class:"table-of-contents"},v=n("h2",{id:"_1-项目简介",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-项目简介","aria-hidden":"true"},"#"),e(" 1. 项目简介")],-1),x=n("thead",null,[n("tr",null,[n("th",null,"项目"),n("th",null,"信息")])],-1),T=n("td",null,"项目地址",-1),P={href:"https://pypi.python.org/pypi/aiofiles",target:"_blank",rel:"noopener noreferrer"},I={href:"https://github.com/Tinche/aiofiles",target:"_blank",rel:"noopener noreferrer"},N=n("tr",null,[n("td",null,"开源协议"),n("td",null,"Apache 2")],-1),z=n("tr",null,[n("td",null,"Python 版本"),n("td",null,"Python 3.6 ~ 3.10")],-1),F=n("tr",null,[n("td",null,"标签"),n("td",null,"asyncio")],-1),V=c(`<p><code>aiofiles</code> 是一个 Apache 2 许可的库，用 Python 编写，用于在 <code>asyncio</code> 应用程序中处理本地磁盘文件。</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>pip <span class="token function">install</span> aiofiles
</code></pre></div><h2 id="_2-特点" tabindex="-1"><a class="header-anchor" href="#_2-特点" aria-hidden="true">#</a> 2. 特点</h2>`,3),A=n("li",null,"非常接机原生 API",-1),C=n("li",null,"支持缓冲区协议和非缓冲区协议的二进制文件",-1),E=n("code",null,"async",-1),L=n("code",null,"await",-1),q={href:"http://www.python.org/dev/peps/pep-0492",target:"_blank",rel:"noopener noreferrer"},B=n("li",null,"支持临时文件",-1),D=c(`<p>普通的本地文件 IO 是阻塞的，不能轻易地、可移植地做成异步的。这意味着做文件 IO 可能会干扰 <code>asyncio</code> 应用程序，它不应该阻塞执行线程。<code>aiofiles</code> 通过引入文件的异步版本，支持将操作委托给一个单独的线程池来帮助解决这个问题。</p><h2 id="_3-示例" tabindex="-1"><a class="header-anchor" href="#_3-示例" aria-hidden="true">#</a> 3. 示例</h2><div class="language-python" data-ext="py"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">with</span> aiofiles<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;filename&#39;</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    contents <span class="token operator">=</span> <span class="token keyword">await</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span>
<span class="token comment"># &#39;My file contents&#39;</span>
</code></pre></div><p>异步迭代也受到支持：</p><div class="language-python" data-ext="py"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">with</span> aiofiles<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;filename&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>异步接口也支持临时文件：</p><div class="language-python" data-ext="py"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">with</span> aiofiles<span class="token punctuation">.</span>tempfile<span class="token punctuation">.</span>TemporaryFile<span class="token punctuation">(</span><span class="token string">&#39;wb&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">await</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b&#39;Hello, World!&#39;</span><span class="token punctuation">)</span>
</code></pre></div><p>文件是使用 <code>aiofiles.open()</code> 的 coroutine 打开的，它除了兼容内置的 <code>open()</code> 之外，还接受可选的 <code>loop</code> 和 <code>executor</code> 参数。如果没有 <code>loop</code>，将使用默认的 <code>loop</code>，按照设定的 <code>asyncio</code> 策略。如果没有指定 <code>executor</code>，将使用默认的事件循环执行器。</p><p>在成功的情况下，一个异步文件对象被返回，其 API 与普通文件相同，除了以下方法是 Coroutines 并委托给一个执行器。</p><ul><li><code>close()</code></li><li><code>flush()</code></li><li><code>isatty()</code></li><li><code>read()</code></li><li><code>readall()</code></li><li><code>read1()</code></li><li><code>readinto()</code></li><li><code>readline()</code></li><li><code>readlines()</code></li><li><code>seek()</code></li><li><code>seekable()</code></li><li><code>tell()</code></li><li><code>truncate()</code></li><li><code>writable()</code></li><li><code>write()</code></li><li><code>writelines()</code></li></ul><p><code>aiofiles.os</code> 模块包含几个处理文件的有用的 <code>os</code> 函数的执行器启用的 Coroutine 版本。</p><ul><li><code>stat()</code></li><li><code>sendfile()</code></li><li><code>rename()</code></li><li><code>renames()</code></li><li><code>replace()</code></li><li><code>remove()</code></li><li><code>unlink()</code></li><li><code>mkdir()</code></li><li><code>makedirs()</code></li><li><code>rmdir()</code></li><li><code>removedirs()</code></li><li><code>link()</code></li><li><code>symlink()</code></li><li><code>readlink()</code></li><li><code>path.exists()</code></li><li><code>path.isfile()</code></li><li><code>path.isdir()</code></li><li><code>path.islink()</code></li><li><code>path.getsize()</code></li><li><code>path.getatime()</code></li><li><code>path.getctime()</code></li><li><code>path.samefile()</code></li><li><code>path.sameopenfile()</code></li></ul><h2 id="_4-临时文件支持" tabindex="-1"><a class="header-anchor" href="#_4-临时文件支持" aria-hidden="true">#</a> 4. 临时文件支持</h2><p><code>aiofiles.tempfile</code> 实现了下列接口：</p><ul><li><code>TemporaryFile</code></li><li><code>NamedTemporaryFile</code></li><li><code>SpooledTemporaryFile</code></li><li><code>TemporaryDirectory</code></li></ul><div class="language-python" data-ext="py"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">with</span> aiofiles<span class="token punctuation">.</span>tempfile<span class="token punctuation">.</span>NamedTemporaryFile<span class="token punctuation">(</span><span class="token string">&#39;wb+&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">await</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b&#39;Line1\\n Line2&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">with</span> aiofiles<span class="token punctuation">.</span>tempfile<span class="token punctuation">.</span>TemporaryDirectory<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> d<span class="token punctuation">:</span>
    filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token string">&quot;file.ext&quot;</span><span class="token punctuation">)</span>
</code></pre></div>`,16);function H(M,O){const a=l("ExternalLinkIcon"),o=l("router-link");return p(),d("div",null,[u,n("p",null,[n("a",k,[h,s(a)]),n("a",_,[f,s(a)]),n("a",y,[g,s(a)]),n("a",m,[w,s(a)])]),n("nav",b,[n("ul",null,[n("li",null,[s(o,{to:"#_1-项目简介"},{default:t(()=>[e("1. 项目简介")]),_:1})]),n("li",null,[s(o,{to:"#_2-特点"},{default:t(()=>[e("2. 特点")]),_:1})]),n("li",null,[s(o,{to:"#_3-示例"},{default:t(()=>[e("3. 示例")]),_:1})]),n("li",null,[s(o,{to:"#_4-临时文件支持"},{default:t(()=>[e("4. 临时文件支持")]),_:1})])])]),v,n("table",null,[x,n("tbody",null,[n("tr",null,[T,n("td",null,[n("a",P,[e("PyPI"),s(a)]),e("、"),n("a",I,[e("GitHub"),s(a)])])]),N,z,F])]),V,n("ul",null,[A,C,n("li",null,[e("支持 "),E,e(" / "),L,e("（"),n("a",q,[e("PEP 492"),s(a)]),e("）结构")]),B]),D])}const j=i(r,[["render",H],["__file","aiofiles.html.vue"]]);export{j as default};

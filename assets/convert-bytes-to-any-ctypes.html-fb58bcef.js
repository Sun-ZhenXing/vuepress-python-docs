import{_ as s,o as n,c as a,e as l}from"./app-e398544c.js";const p={},e=l(`<h1 id="将-bytes-转换为任意-c-类型" tabindex="-1"><a class="header-anchor" href="#将-bytes-转换为任意-c-类型" aria-hidden="true">#</a> 将 bytes 转换为任意 C 类型</h1><p>下面的方法实现了 <code>bytes</code> 转换到任意 C 类型。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> ctypes </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> POINTER, c_char_p, c_double, cast, sizeof</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> typing </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> TypeVar</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">_T = TypeVar(</span><span style="color:#CE9178;">&#39;_T&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">cast_bytes</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">data_bytes</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">bytes</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">ctype</span><span style="color:#D4D4D4;">: type[_T]) -&gt; _T:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">&quot;&quot;&quot;Cast bytes to a ctype&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">assert</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(data_bytes) &gt;= sizeof(ctype)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> cast(</span></span>
<span class="line"><span style="color:#D4D4D4;">        c_char_p(data_bytes),</span></span>
<span class="line"><span style="color:#D4D4D4;">        POINTER(ctype)</span></span>
<span class="line"><span style="color:#D4D4D4;">    ).contents</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">v = cast_bytes(</span><span style="color:#569CD6;">b</span><span style="color:#CE9178;">&#39;</span><span style="color:#D7BA7D;">\\x7f</span><span style="color:#CE9178;">&#39;</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">8</span><span style="color:#D4D4D4;">, c_double)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(v.value)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样我们就获得了一个 <code>c_double</code> 类型的 <code>v</code> 变量，使用 <code>v.value</code> 很容易获得其值。</p><p>以上的代码相当于下面的 C++ 代码：</p><div class="language-cpp" data-ext="cpp"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">#include</span><span style="color:#569CD6;"> </span><span style="color:#CE9178;">&lt;iostream&gt;</span></span>
<span class="line"><span style="color:#C586C0;">using</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">namespace</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">std</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">char</span><span style="color:#D4D4D4;"> a[] = </span><span style="color:#CE9178;">&quot;</span><span style="color:#D7BA7D;">\\x7f\\x7f\\x7f\\x7f\\x7f\\x7f\\x7f\\x7f</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">double</span><span style="color:#D4D4D4;"> value = *(</span><span style="color:#569CD6;">double</span><span style="color:#D4D4D4;">*)a;</span></span>
<span class="line"><span style="color:#D4D4D4;">    cout &lt;&lt; value &lt;&lt; endl;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div><p>如果需要使用 Python 将 C 类型转换为二进制表示，使用 <code>memoryview</code> 即可。</p>`,7),o=[e];function c(t,D){return n(),a("div",null,o)}const i=s(p,[["render",c],["__file","convert-bytes-to-any-ctypes.html.vue"]]);export{i as default};

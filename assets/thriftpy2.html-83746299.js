import{_ as i,r,o as D,c as y,b as s,a as n,w as t,d as l,e as h}from"./app-9f566e20.js";const d={},_=s("h1",{id:"thriftpy2-thrift-rpc-框架的高性能-python-实现",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#thriftpy2-thrift-rpc-框架的高性能-python-实现","aria-hidden":"true"},"#"),l(" thriftpy2 - Thrift RPC 框架的高性能 Python 实现")],-1),C={class:"no-link"},f={href:"https://travis-ci.com/Thriftpy/thriftpy2",target:"_blank",rel:"noopener noreferrer"},u=s("img",{src:"https://travis-ci.com/Thriftpy/thriftpy2.svg?branch=develop",alt:"",loading:"lazy"},null,-1),g=s("br",null,null,-1),m={href:"https://codecov.io/gh/Thriftpy/thriftpy2",target:"_blank",rel:"noopener noreferrer"},E=s("img",{src:"https://img.shields.io/codecov/c/github/Thriftpy/thriftpy2.svg",alt:"",loading:"lazy"},null,-1),v=s("br",null,null,-1),b={href:"https://pypi.org/project/thriftpy2/",target:"_blank",rel:"noopener noreferrer"},k=s("img",{src:"https://img.shields.io/pypi/dm/thriftpy2.svg",alt:"",loading:"lazy"},null,-1),A=s("br",null,null,-1),x={href:"https://pypi.org/project/thriftpy2/",target:"_blank",rel:"noopener noreferrer"},P=s("img",{src:"https://img.shields.io/pypi/v/thriftpy2.svg",alt:"",loading:"lazy"},null,-1),T=s("br",null,null,-1),B={href:"https://pypi.org/project/thriftpy2/",target:"_blank",rel:"noopener noreferrer"},F=s("img",{src:"https://img.shields.io/pypi/pyversions/thriftpy2.svg",alt:"",loading:"lazy"},null,-1),j=s("br",null,null,-1),S={href:"https://pypi.org/project/thriftpy2/",target:"_blank",rel:"noopener noreferrer"},w=s("img",{src:"https://img.shields.io/pypi/implementation/thriftpy2.svg",alt:"",loading:"lazy"},null,-1),z={class:"table-of-contents"},I=s("h2",{id:"_1-项目简介",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-项目简介","aria-hidden":"true"},"#"),l(" 1. 项目简介")],-1),N=s("thead",null,[s("tr",null,[s("th",null,"项目"),s("th",null,"信息")])],-1),V=s("td",null,"项目地址",-1),R={href:"https://pypi.org/project/thriftpy2/",target:"_blank",rel:"noopener noreferrer"},q={href:"https://github.com/Thriftpy/thriftpy2",target:"_blank",rel:"noopener noreferrer"},L=s("td",null,"官方文档",-1),G={href:"https://thriftpy2.readthedocs.io/en/latest/",target:"_blank",rel:"noopener noreferrer"},H=s("tr",null,[s("td",null,"开源协议"),s("td",null,"MIT")],-1),M=s("tr",null,[s("td",null,"Python 版本"),s("td",null,"Python 2.7 ~ 3.11")],-1),J=s("tr",null,[s("td",null,"标签"),s("td",null,"RPC、asyncio")],-1),K=s("p",null,[l("ThriftPy2 是 Thrift RPC 框架的 Python 实现，它是官方 Thrift Python 包的另一个实现，兼容 "),s("code",null,"thriftpy"),l("，并且提供了无需编译 "),s("code",null,".thrift"),l(" 文件即可直接使用的功能。")],-1),O=s("code",null,"thriftpy",-1),Q={href:"https://thriftpy2.readthedocs.io/en/latest/#benchmarks",target:"_blank",rel:"noopener noreferrer"},U=h(`<p>如果你需要使用 ThriftPy2，你需要安装 <code>cython</code> 和 <code>thriftpy2</code>：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">pip</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">install</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">cython</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">thriftpy2</span></span>
<span class="line"></span></code></pre></div><p>由于 ThriftPy2 兼容 <code>thriftpy</code>，所以你可以使用 <code>thriftpy</code> 的方式来使用 ThriftPy2：</p><div class="language-python" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> thriftpy2 </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> thriftpy</span></span>
<span class="line"></span></code></pre></div><h2 id="_2-快速开始" tabindex="-1"><a class="header-anchor" href="#_2-快速开始" aria-hidden="true">#</a> 2. 快速开始</h2><p>下面所使用的 Thrift 文件如下：</p><div class="language-go" data-ext="go"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">service PingPong {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">ping</span><span style="color:#D4D4D4;">(),</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div><p>基本示例：</p>`,8),W=s("div",{class:"language-python","data-ext":"py"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"from"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2.rpc "),s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," make_server")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"pingpong_thrift = thriftpy2.load("),s("span",{style:{color:"#CE9178"}},'"pingpong.thrift"'),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#9CDCFE"}},"module_name"),s("span",{style:{color:"#D4D4D4"}},"="),s("span",{style:{color:"#CE9178"}},'"pingpong_thrift"'),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6"}},"class"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#4EC9B0"}},"Dispatcher"),s("span",{style:{color:"#D4D4D4"}},"("),s("span",{style:{color:"#4EC9B0"}},"object"),s("span",{style:{color:"#D4D4D4"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"def"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#DCDCAA"}},"ping"),s("span",{style:{color:"#D4D4D4"}},"("),s("span",{style:{color:"#9CDCFE"}},"self"),s("span",{style:{color:"#D4D4D4"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"        "),s("span",{style:{color:"#C586C0"}},"return"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},'"pong"')]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"server = make_server(pingpong_thrift.PingPong, Dispatcher(), "),s("span",{style:{color:"#CE9178"}},"'127.0.0.1'"),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#B5CEA8"}},"6000"),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"server.serve()")]),l(`
`),s("span",{class:"line"})])])],-1),X=s("div",{class:"language-python","data-ext":"py"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"from"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2.rpc "),s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," make_client")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"pingpong_thrift = thriftpy2.load("),s("span",{style:{color:"#CE9178"}},'"pingpong.thrift"'),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#9CDCFE"}},"module_name"),s("span",{style:{color:"#D4D4D4"}},"="),s("span",{style:{color:"#CE9178"}},'"pingpong_thrift"'),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"client = make_client(pingpong_thrift.PingPong, "),s("span",{style:{color:"#CE9178"}},"'127.0.0.1'"),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#B5CEA8"}},"6000"),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"print"),s("span",{style:{color:"#D4D4D4"}},"(client.ping())")]),l(`
`),s("span",{class:"line"})])])],-1),Y=s("p",null,[l("同样支持 "),s("code",null,"asyncio"),l("，使用上述 Thrift 文件，我们可以这样写：")],-1),Z=s("div",{class:"language-python","data-ext":"py"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," asyncio")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"from"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2.rpc "),s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," make_aio_server")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"echo_thrift = thriftpy2.load("),s("span",{style:{color:"#CE9178"}},'"echo.thrift"'),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#9CDCFE"}},"module_name"),s("span",{style:{color:"#D4D4D4"}},"="),s("span",{style:{color:"#CE9178"}},'"echo_thrift"'),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6"}},"class"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#4EC9B0"}},"Dispatcher"),s("span",{style:{color:"#D4D4D4"}},"("),s("span",{style:{color:"#4EC9B0"}},"object"),s("span",{style:{color:"#D4D4D4"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"async"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#569CD6"}},"def"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#DCDCAA"}},"echo"),s("span",{style:{color:"#D4D4D4"}},"("),s("span",{style:{color:"#9CDCFE"}},"self"),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#9CDCFE"}},"param"),s("span",{style:{color:"#D4D4D4"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"        "),s("span",{style:{color:"#DCDCAA"}},"print"),s("span",{style:{color:"#D4D4D4"}},"(param)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"        "),s("span",{style:{color:"#C586C0"}},"await"),s("span",{style:{color:"#D4D4D4"}}," asyncio.sleep("),s("span",{style:{color:"#B5CEA8"}},"0.1"),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"        "),s("span",{style:{color:"#C586C0"}},"return"),s("span",{style:{color:"#D4D4D4"}}," param")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6"}},"def"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#DCDCAA"}},"main"),s("span",{style:{color:"#D4D4D4"}},"():")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    server = make_aio_server(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"        echo_thrift.EchoService, Dispatcher(), "),s("span",{style:{color:"#CE9178"}},"'127.0.0.1'"),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#B5CEA8"}},"6000"),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    server.serve()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"if"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#9CDCFE"}},"__name__"),s("span",{style:{color:"#D4D4D4"}}," == "),s("span",{style:{color:"#CE9178"}},"'__main__'"),s("span",{style:{color:"#D4D4D4"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    main()")]),l(`
`),s("span",{class:"line"})])])],-1),$=s("div",{class:"language-python","data-ext":"py"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," asyncio")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"from"),s("span",{style:{color:"#D4D4D4"}}," thriftpy2.rpc "),s("span",{style:{color:"#C586C0"}},"import"),s("span",{style:{color:"#D4D4D4"}}," make_aio_client")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"echo_thrift = thriftpy2.load("),s("span",{style:{color:"#CE9178"}},'"echo.thrift"'),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#9CDCFE"}},"module_name"),s("span",{style:{color:"#D4D4D4"}},"="),s("span",{style:{color:"#CE9178"}},'"echo_thrift"'),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6"}},"async"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#569CD6"}},"def"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#DCDCAA"}},"request"),s("span",{style:{color:"#D4D4D4"}},"():")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    client = "),s("span",{style:{color:"#C586C0"}},"await"),s("span",{style:{color:"#D4D4D4"}}," make_aio_client(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"        echo_thrift.EchoService, "),s("span",{style:{color:"#CE9178"}},"'127.0.0.1'"),s("span",{style:{color:"#D4D4D4"}},", "),s("span",{style:{color:"#B5CEA8"}},"6000"),s("span",{style:{color:"#D4D4D4"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#DCDCAA"}},"print"),s("span",{style:{color:"#D4D4D4"}},"("),s("span",{style:{color:"#C586C0"}},"await"),s("span",{style:{color:"#D4D4D4"}}," client.echo("),s("span",{style:{color:"#CE9178"}},"'hello, world'"),s("span",{style:{color:"#D4D4D4"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    client.close()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0"}},"if"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#9CDCFE"}},"__name__"),s("span",{style:{color:"#D4D4D4"}}," == "),s("span",{style:{color:"#CE9178"}},"'__main__'"),s("span",{style:{color:"#D4D4D4"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    loop = asyncio.get_event_loop()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    loop.run_until_complete(request())")]),l(`
`),s("span",{class:"line"})])])],-1);function ss(ls,ns){const o=r("ExternalLinkIcon"),p=r("router-link"),c=r("CodeTabs");return D(),y("div",null,[_,s("div",C,[s("p",null,[s("a",f,[u,n(o)]),g,s("a",m,[E,n(o)]),v,s("a",b,[k,n(o)]),A,s("a",x,[P,n(o)]),T,s("a",B,[F,n(o)]),j,s("a",S,[w,n(o)])])]),s("nav",z,[s("ul",null,[s("li",null,[n(p,{to:"#_1-项目简介"},{default:t(()=>[l("1. 项目简介")]),_:1})]),s("li",null,[n(p,{to:"#_2-快速开始"},{default:t(()=>[l("2. 快速开始")]),_:1})])])]),I,s("table",null,[N,s("tbody",null,[s("tr",null,[V,s("td",null,[s("a",R,[l("PyPI"),n(o)]),l(" | "),s("a",q,[l("GitHub"),n(o)])])]),s("tr",null,[L,s("td",null,[s("a",G,[l("官方文档"),n(o)])])]),H,M,J])]),K,s("p",null,[l("ThriftPy2 的速度比 "),O,l(" 快许多，这可以从官方的 "),s("a",Q,[l("benchmark"),n(o)]),l(" 中找到。")]),U,n(c,{id:"92",data:[{id:"Server"},{id:"Client"}]},{title0:t(({value:e,isActive:a})=>[l("Server")]),title1:t(({value:e,isActive:a})=>[l("Client")]),tab0:t(({value:e,isActive:a})=>[W]),tab1:t(({value:e,isActive:a})=>[X]),_:1}),Y,n(c,{id:"103",data:[{id:"Server"},{id:"Client"}]},{title0:t(({value:e,isActive:a})=>[l("Server")]),title1:t(({value:e,isActive:a})=>[l("Client")]),tab0:t(({value:e,isActive:a})=>[Z]),tab1:t(({value:e,isActive:a})=>[$]),_:1})])}const ts=i(d,[["render",ss],["__file","thriftpy2.html.vue"]]);export{ts as default};

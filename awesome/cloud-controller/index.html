<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/vuepress-python-notes/favicon.svg"><title>Python 课程设计：Django 开发云控制器 | Python 笔记</title><meta name="description" content="Python 课程设计：Django 开发云控制器">
    <link rel="preload" href="/vuepress-python-notes/assets/style-a70d6a1e.css" as="style"><link rel="stylesheet" href="/vuepress-python-notes/assets/style-a70d6a1e.css">
    <link rel="modulepreload" href="/vuepress-python-notes/assets/app-69c72c30.js"><link rel="modulepreload" href="/vuepress-python-notes/assets/index.html-2ac7b9b7.js"><link rel="modulepreload" href="/vuepress-python-notes/assets/index.html-a7ed98a8.js"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-07563607.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-57c5a2bf.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-6fb7261b.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-88fb5f25.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-0b720649.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/cython-build-image.html-138ac9d2.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-ac979a80.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/temp.html-5a98a899.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-0504b94f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-27d1daed.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/ctypes.html-fa93a542.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-d706914c.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/intro.html-a4e325fd.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/aiofiles.html-7292ef68.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/asyncio-mqtt.html-daf3459f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-d613d454.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-9842b183.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/parso.html-a2b9880e.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-2f663f8d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-b60dc0b3.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-90a08021.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-2fa32cf5.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/thriftpy2.html-e847a6df.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-1cb59d55.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-4906c1d5.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/jinja2.html-e3fb86ca.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/click.html-c7d46b07.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-7124ae46.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/jsonpath.html-3496b204.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/paramiko.html-a301cbba.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/prettytable.html-db88ab98.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/retrying.html-657d701f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/six.html-33c186c5.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-09d4cc75.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/pool.html-4647759a.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/subprocess.html-475099d7.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/case-insensitive-dict.html-db1aa09f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/convert-bytes-to-any-ctypes.html-81887f08.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/decimal-conversion.html-26b23758.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/import-python-file-from-path.html-426f07a4.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-9a8c9589.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/python-ebnf.html-9cc2b258.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/system-desktop.html-505dd9e1.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-af8411c5.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/segment-fault.html-284bd792.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-63876557.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/sqlalchemy-lost-connection.html-873ffe0d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-feb0942a.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-d3967908.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/operator.html-032bc49f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/tricks.html-aed5c3d5.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/glob.html-102fdb6a.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-2f23f845.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/operator.html-829b355b.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/re.html-8a2e7215.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/sqlite3.html-27002b3b.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/venv.html-a8425e38.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/command.html-5010e1b7.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/errors.html-38c9e4b6.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-0d102741.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/mirrors.html-f4244302.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/proxy.html-fa494831.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-fd770325.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-3e0beff3.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-996b35ee.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-a6c39d37.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-a5e2b03e.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-c5676e18.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-3eec93b8.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-c8629ae8.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-0c619146.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-88d44155.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-26cde6c9.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-8f3e2062.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/404.html-e7f61752.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-a10ab4ab.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-cb20cbf5.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-8bc1d234.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-b92cb076.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-b2c604fe.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/cython-build-image.html-5e0b1aa1.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-4b3b68bc.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/temp.html-cbbaf57e.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-63c92687.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-de881bf8.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/ctypes.html-d39bae52.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-a16e01e7.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/intro.html-292dd15f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/aiofiles.html-e2cb1e07.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/asyncio-mqtt.html-58cd59ec.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-e4c64de8.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-7c8c4a5f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/parso.html-b3bb1a24.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-3dbd17d9.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-8bba6c73.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-b6d8a223.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-e858375d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/thriftpy2.html-3575e868.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-99392927.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-bb96635e.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/jinja2.html-aa975b35.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/click.html-15f0b0ae.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-0648606e.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/jsonpath.html-bd7fbb7a.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/paramiko.html-b63d2847.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/prettytable.html-8e66df72.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/retrying.html-716d488d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/six.html-344d19ed.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-ad82dcc3.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/pool.html-5f3f2867.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/subprocess.html-75dd62ff.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/case-insensitive-dict.html-32a9a913.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/convert-bytes-to-any-ctypes.html-f29e18c2.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/decimal-conversion.html-501ecdc8.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/import-python-file-from-path.html-ba18cfcd.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-5ea496b2.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/python-ebnf.html-40e00ffe.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/system-desktop.html-6e54f4c3.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-8b20c8b7.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/segment-fault.html-b977b5af.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-755b0017.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/sqlalchemy-lost-connection.html-d47b0ded.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-70b041b4.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-27658e9e.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/operator.html-1a4af035.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/tricks.html-fb6ce629.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/glob.html-4fb70a66.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-05314759.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/operator.html-d7640bd3.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/re.html-6052987d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/sqlite3.html-444d60a1.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/venv.html-75058b24.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/command.html-d08afae5.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/errors.html-99ddc1cc.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-cdd76882.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/mirrors.html-3b2b815b.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/proxy.html-9a120682.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-e989b47d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-28eebb7a.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-8a17c39b.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-4a40ae21.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-e699a0ac.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-af5f69f4.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-1ddc082d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-bdfb966c.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-75e0264c.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-37587d5d.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-a77cf018.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/index.html-a21881af.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/404.html-81157ce7.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/mermaid.core-b41b6f85.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/copy-tex.min-a72ade3f.js" as="script"><link rel="prefetch" href="/vuepress-python-notes/assets/SearchResult-818a5a4c.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vuepress-python-notes/" class=""><img class="logo" src="/vuepress-python-notes/favicon.svg" alt="Python 笔记"><span class="site-name can-hide">Python 笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/Sun-ZhenXing/vuepress-python-notes/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/Sun-ZhenXing/vuepress-python-notes/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Python 课程设计：Django 开发云控制器 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#1-项目背景和课程目标" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 项目背景和课程目标"><!--[--><!--]--> 1. 项目背景和课程目标 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#11-项目背景" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 项目背景"><!--[--><!--]--> 1.1 项目背景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#12-课程目标" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 课程目标"><!--[--><!--]--> 1.2 课程目标 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#2-课程设计内容" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 课程设计内容"><!--[--><!--]--> 2. 课程设计内容 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#21-设计目标" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 设计目标"><!--[--><!--]--> 2.1 设计目标 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#22-模型设计" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 模型设计"><!--[--><!--]--> 2.2 模型设计 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#23-接口设计" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 接口设计"><!--[--><!--]--> 2.3 接口设计 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#3-项目设计步骤" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. 项目设计步骤"><!--[--><!--]--> 3. 项目设计步骤 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#31-项目结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 项目结构"><!--[--><!--]--> 3.1 项目结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#32-创建项目" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 创建项目"><!--[--><!--]--> 3.2 创建项目 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#33-定义模型" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 定义模型"><!--[--><!--]--> 3.3 定义模型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#34-创建序列化类" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 创建序列化类"><!--[--><!--]--> 3.4 创建序列化类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#35-编写-api-视图" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5 编写 API 视图"><!--[--><!--]--> 3.5 编写 API 视图 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#附录-a什么是-cidr" class="router-link-active router-link-exact-active sidebar-item" aria-label="附录 A：什么是 CIDR"><!--[--><!--]--> 附录 A：什么是 CIDR <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#附录-bpython-计算可用-ip-信息" class="router-link-active router-link-exact-active sidebar-item" aria-label="附录 B：Python 计算可用 IP 信息"><!--[--><!--]--> 附录 B：Python 计算可用 IP 信息 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="python-课程设计django-开发云控制器" tabindex="-1"><a class="header-anchor" href="#python-课程设计django-开发云控制器" aria-hidden="true">#</a> Python 课程设计：Django 开发云控制器</h1><p>本文介绍 Python 课程设计 <em>Django 开发云控制器</em> 的设计过程和具体实现。</p><div class="hint-container info"><p class="hint-container-title">GitHub</p><p>现在已经开源在 GitHub：<a href="https://github.com/Sun-ZhenXing/python-net-controller" target="_blank" rel="noopener noreferrer">Sun-ZhenXing/python-net-controller<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>，不过这是实验性的项目，仅仅作文课程设计而不是生产可用的。</p></div><nav class="table-of-contents"><ul><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#1-项目背景和课程目标" class="router-link-active router-link-exact-active">1. 项目背景和课程目标</a><ul><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#11-项目背景" class="router-link-active router-link-exact-active">1.1 项目背景</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#12-课程目标" class="router-link-active router-link-exact-active">1.2 课程目标</a></li></ul></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#2-课程设计内容" class="router-link-active router-link-exact-active">2. 课程设计内容</a><ul><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#21-设计目标" class="router-link-active router-link-exact-active">2.1 设计目标</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#22-模型设计" class="router-link-active router-link-exact-active">2.2 模型设计</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#23-接口设计" class="router-link-active router-link-exact-active">2.3 接口设计</a></li></ul></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#3-项目设计步骤" class="router-link-active router-link-exact-active">3. 项目设计步骤</a><ul><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#31-项目结构" class="router-link-active router-link-exact-active">3.1 项目结构</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#32-创建项目" class="router-link-active router-link-exact-active">3.2 创建项目</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#33-定义模型" class="router-link-active router-link-exact-active">3.3 定义模型</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#34-创建序列化类" class="router-link-active router-link-exact-active">3.4 创建序列化类</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#35-编写-api-视图" class="router-link-active router-link-exact-active">3.5 编写 API 视图</a></li></ul></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#附录-a什么是-cidr" class="router-link-active router-link-exact-active">附录 A：什么是 CIDR</a></li><li><a aria-current="page" href="/vuepress-python-notes/awesome/cloud-controller/#附录-bpython-计算可用-ip-信息" class="router-link-active router-link-exact-active">附录 B：Python 计算可用 IP 信息</a></li></ul></nav><h2 id="1-项目背景和课程目标" tabindex="-1"><a class="header-anchor" href="#1-项目背景和课程目标" aria-hidden="true">#</a> 1. 项目背景和课程目标</h2><h3 id="11-项目背景" tabindex="-1"><a class="header-anchor" href="#11-项目背景" aria-hidden="true">#</a> 1.1 项目背景</h3><p>随着 SDN 概念的提出和流行，越来越多的企业开始尝试使用将复杂网络结构定义为可编程的。云控制器将北向开放 RESTful API 给用户使用，南向接口负责接入不同厂商的设备，将不同的设备抽象为一致的接口，大大减少网络运行和维护的成本。</p><h3 id="12-课程目标" tabindex="-1"><a class="header-anchor" href="#12-课程目标" aria-hidden="true">#</a> 1.2 课程目标</h3><p>本项目在云控制器项目的背景下，创建一个有代表性的、简单的场景，管理和分配不同的网络端口。</p><p>通过完成接口设计及接口实现达成以下目标：</p><ul><li>Python 语言在企业级项目中的使用</li><li>Django 框架了解及使用</li><li>RESTful API 了解及设计</li><li>Postman 工具学习及使用</li></ul><h2 id="2-课程设计内容" tabindex="-1"><a class="header-anchor" href="#2-课程设计内容" aria-hidden="true">#</a> 2. 课程设计内容</h2><h3 id="21-设计目标" tabindex="-1"><a class="header-anchor" href="#21-设计目标" aria-hidden="true">#</a> 2.1 设计目标</h3><p>使用 Django 实现一套 RESTful 风格的 API，能够支持 Port 的 CURD，并能够分配可用 IP 给 Port。同时尽可能多地实现其他网络相关结构。</p><h3 id="22-模型设计" tabindex="-1"><a class="header-anchor" href="#22-模型设计" aria-hidden="true">#</a> 2.2 模型设计</h3><p>模型 E-R 图结构：</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>创建数据库和表：</p><div class="hint-container warning"><p class="hint-container-title">数据模型</p><p>如果定义了数据模型则会使用数据模型，为了方便理解这里使用 SQL 定义。</p></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATABASE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NOT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`controller`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">USE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`controller`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`Network`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">Network</span><span style="color:#D4D4D4;">`(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">64</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`availability_zone_hints`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`status`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`Subnet`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">Subnet</span><span style="color:#D4D4D4;">`(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">64</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`cidr`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`network_id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`Port`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">Port</span><span style="color:#D4D4D4;">`(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">64</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`ip`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`subnet_id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>模型关系约束：</p><ul><li>相同 <code>availability_zone_hints</code> 下 <code>name</code> 不能重复</li><li>同一个 Network 下的 <code>Subnet.cidr</code> 不能重复</li><li>同一个子网下的 <code>ip</code> 不能重复，一般情况下 IP 由系统分配，不会重复</li><li>所有的 <code>id</code> 一律使用 UUID，并作为主键</li><li>网络的状态 <code>status</code> 只能是 <code>ACTIVE</code>（激活）、<code>INACTIVE</code>（未激活）或 <code>DISABLE</code>（禁用的）</li></ul><h3 id="23-接口设计" tabindex="-1"><a class="header-anchor" href="#23-接口设计" aria-hidden="true">#</a> 2.3 接口设计</h3><p>接口概览：</p><table><thead><tr><th>接口</th><th>说明</th></tr></thead><tbody><tr><td><code>GET /v1/networks</code></td><td>获取 Network 信息</td></tr><tr><td><code>GET /v1/networks/:id</code></td><td>获取某个 Network 信息</td></tr><tr><td><code>POST /v1/networks</code></td><td>新建 Network</td></tr><tr><td><code>DELETE /v1/networks/:id</code></td><td>删除 Network</td></tr><tr><td><code>PUT /v1/networks/:id</code></td><td>更新某个 Network 的信息</td></tr><tr><td><code>GET /v1/subnets</code></td><td>获取 Subnet 信息</td></tr><tr><td><code>GET /v1/subnets/:id</code></td><td>获取某个 Subnet 信息</td></tr><tr><td><code>POST /v1/subnets</code></td><td>新建 Subnet</td></tr><tr><td><code>DELETE /v1/subnets/:id</code></td><td>删除 Subnet</td></tr><tr><td><code>PUT /v1/subnets/:id</code></td><td>更新某个 Subnet 的信息</td></tr><tr><td><code>GET /v1/ports</code></td><td>获取 Port 信息</td></tr><tr><td><code>GET /v1/ports/:id</code></td><td>获取某个 Port 信息</td></tr><tr><td><code>POST /v1/ports</code></td><td>新建 Port</td></tr><tr><td><code>DELETE /v1/ports/:id</code></td><td>删除 Port</td></tr><tr><td><code>PUT /v1/ports/:id</code></td><td>更新某个 Port 的信息</td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">关于鉴权</p><p>现阶段不涉及鉴权相关的内容，如果有鉴权需要，可以参考使用 JWT 授权，或者使用 OAuth 2.0 授权协议，需要确保通信是 SSL 连接。</p></div><h4 id="接口get-v1networks" tabindex="-1"><a class="header-anchor" href="#接口get-v1networks" aria-hidden="true">#</a> 接口：<code>GET /v1/networks</code></h4><ul><li><p>内容：获取网络信息</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>offset</code></td><td>可选，指定返回记录的开始位置</td></tr><tr><td><code>limit</code></td><td>可选，限制请求数量</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>GET /v1/networks?limit=10&amp;offset=20</code></p></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;status&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ACTIVE&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az1&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    },</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network002&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;status&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ACTIVE&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az1&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    },</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000f0e1d-7c8f-4321-ac02-78be25fce6b7&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network003&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;status&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ACTIVE&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az2&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口get-v1networksid" tabindex="-1"><a class="header-anchor" href="#接口get-v1networksid" aria-hidden="true">#</a> 接口：<code>GET /v1/networks/:id</code></h4><ul><li><p>内容：获取某个网络信息</p></li><li><p>参数：无</p></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>GET /v1/networks/000006ac-ea63-4dd1-83e6-596e10a89366</code></p></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;status&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ACTIVE&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az1&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口post-v1networks" tabindex="-1"><a class="header-anchor" href="#接口post-v1networks" aria-hidden="true">#</a> 接口：<code>POST /v1/networks</code></h4><ul><li><p>内容：新建一个网络</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>name</code></td><td>网络的名称</td></tr><tr><td><code>availability_zone_hints</code></td><td>网络区域</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>POST /v1/networks</code></p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az1&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;status&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ACTIVE&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az1&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口delete-v1networksid" tabindex="-1"><a class="header-anchor" href="#接口delete-v1networksid" aria-hidden="true">#</a> 接口：<code>DELETE /v1/networks/:id</code></h4><div class="hint-container warning"><p class="hint-container-title">注意</p><p>删除操作是危险的，因为默认的删除是 <strong>级联</strong> 的，这将删除此网络下的所有子网和端口。</p></div><ul><li><p>内容：删除一个网络</p></li><li><p>参数：无</p></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>DELETE /v1/networks/000006ac-ea63-4dd1-83e6-596e10a89366</code></p></li><li><p>返回示例</p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;affected&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li></ul><h4 id="接口put-v1networksid" tabindex="-1"><a class="header-anchor" href="#接口put-v1networksid" aria-hidden="true">#</a> 接口：<code>PUT /v1/networks/:id</code></h4><ul><li><p>内容：修改一个网络的信息</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>name</code></td><td>网络的名称</td></tr><tr><td><code>availability_zone_hints</code></td><td>网络区域</td></tr><tr><td><code>status</code></td><td>网络的状态</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>PUT /v1/networks/000006ac-ea63-4dd1-83e6-596e10a89366&quot;</code></p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az1&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;status&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ACTIVE&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;network001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;status&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ACTIVE&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;availability_zone_hints&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;az1&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口get-v1subnets" tabindex="-1"><a class="header-anchor" href="#接口get-v1subnets" aria-hidden="true">#</a> 接口：<code>GET /v1/subnets</code></h4><ul><li><p>内容：获取网络信息</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>offset</code></td><td>可选，指定返回记录的开始位置</td></tr><tr><td><code>limit</code></td><td>可选，限制请求数量</td></tr><tr><td><code>network_id</code></td><td>可选，从某个网络中查找</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>GET /v1/subnets?limit=15&amp;offset=10</code></p></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;subnet001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;cidr&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.0/24&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    },</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00da810c-ea63-0064-83e6-59a693de1066&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;subnet002&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;cidr&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.34.0/24&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口get-v1subnetsid" tabindex="-1"><a class="header-anchor" href="#接口get-v1subnetsid" aria-hidden="true">#</a> 接口：<code>GET /v1/subnets/:id</code></h4><ul><li><p>内容：获取某个子网的信息，返回信息包括可用 IP 数和可用 IP 地址，以 <code>[start, end]</code> 的形式给出</p></li><li><p>参数：无</p></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>GET /v1/subnets/000006ac-ea63-4dd1-83e6-596e10a89366</code></p></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;subnet001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;cidr&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.0/24&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ],</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;available_ip&quot;</span><span style="color:#D4D4D4;">: {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;total&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;available&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">28</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;ips&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">      {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">&quot;start&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.1&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">&quot;end&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.25&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">      },</span></span>
<span class="line"><span style="color:#D4D4D4;">      {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">&quot;start&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.28&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">&quot;end&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.32&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    ],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;netmask&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;255.255.255.0&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口post-v1subnets" tabindex="-1"><a class="header-anchor" href="#接口post-v1subnets" aria-hidden="true">#</a> 接口：<code>POST /v1/subnets</code></h4><ul><li><p>内容：新建一个子网</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>name</code></td><td>子网的名称</td></tr><tr><td><code>network_id</code></td><td>网络 ID</td></tr><tr><td><code>cidr</code></td><td>CIDR</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>POST /v1/subnets</code></p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;subnet001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00016ac-ea63-42d1-83e6-8394819effa8&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;cidr&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.1.0/24&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00da810c-ea63-0064-83e6-59a693de1066&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;subnet002&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;cidr&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.34.0/24&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口delete-v1subnetsid" tabindex="-1"><a class="header-anchor" href="#接口delete-v1subnetsid" aria-hidden="true">#</a> 接口：<code>DELETE /v1/subnets/:id</code></h4><div class="hint-container warning"><p class="hint-container-title">注意</p><p>删除操作是危险的，因为默认的删除是 <strong>级联</strong> 的，这将删除此子网下的所有端口。</p></div><ul><li><p>内容：删除一个子网</p></li><li><p>参数：无</p></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>DELETE /v1/subnets/000006ac-ea63-4dd1-83e6-596e10a89366</code></p></li><li><p>返回示例</p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;affected&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li></ul><h4 id="接口put-v1subnetsid" tabindex="-1"><a class="header-anchor" href="#接口put-v1subnetsid" aria-hidden="true">#</a> 接口：<code>PUT /v1/subnets/:id</code></h4><ul><li><p>内容：修改一个子网的信息，修改 <code>cird</code> 时会重新分配此子网下的所有端口</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>name</code></td><td>子网的名称</td></tr><tr><td><code>network_id</code></td><td>网络的 ID</td></tr><tr><td><code>cidr</code></td><td>CIDR</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>PUT /v1/subnets/000006ac-ea63-4dd1-83e6-596e10a89366&quot;</code></p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;subnet001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00016ac-ea63-42d1-83e6-8394819effa8&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;cidr&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.1.0/24&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00da810c-ea63-0064-83e6-59a693de1066&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;subnet002&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;cidr&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.34.0/24&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口get-v1ports" tabindex="-1"><a class="header-anchor" href="#接口get-v1ports" aria-hidden="true">#</a> 接口：<code>GET /v1/ports</code></h4><ul><li><p>内容：获取端口信息</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>offset</code></td><td>可选，指定返回记录的开始位置</td></tr><tr><td><code>limit</code></td><td>可选，限制请求数量</td></tr><tr><td><code>subnet_id</code></td><td>可选，从某个子网中查找</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>GET /v1/ports?limit=15&amp;offset=10</code></p></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;port001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;subnet_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;ip&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.3&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口get-v1portsid" tabindex="-1"><a class="header-anchor" href="#接口get-v1portsid" aria-hidden="true">#</a> 接口：<code>GET /v1/ports/:id</code></h4><ul><li><p>内容：获取某个端口的信息</p></li><li><p>参数：无</p></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>GET /v1/ports/000006ac-ea63-4dd1-83e6-596e10a89366</code></p></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;port001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;subnet_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;ip&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.3&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口post-v1ports" tabindex="-1"><a class="header-anchor" href="#接口post-v1ports" aria-hidden="true">#</a> 接口：<code>POST /v1/ports</code></h4><ul><li><p>内容：新建一个端口，系统将自动分配 IP 地址</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>name</code></td><td>端口的名称</td></tr><tr><td><code>subnet_id</code></td><td>子网 ID</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>POST /v1/ports</code></p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;port001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;subnet_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00016ac-ea63-42d1-83e6-8394819effa8&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;port001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;subnet_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00016ac-ea63-42d1-83e6-8394819effa8&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;ip&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.3&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="接口delete-v1portsid" tabindex="-1"><a class="header-anchor" href="#接口delete-v1portsid" aria-hidden="true">#</a> 接口：<code>DELETE /v1/ports/:id</code></h4><ul><li><p>内容：删除一个端口</p></li><li><p>参数：无</p></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>DELETE /v1/ports/000006ac-ea63-4dd1-83e6-596e10a89366</code></p></li><li><p>返回示例</p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;affected&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li></ul><h4 id="接口put-v1portsid" tabindex="-1"><a class="header-anchor" href="#接口put-v1portsid" aria-hidden="true">#</a> 接口：<code>PUT /v1/ports/:id</code></h4><ul><li><p>内容：修改一个端口的信息，如果修改 <code>network_id</code> 那么系统将收回 IP 并重新分配</p></li><li><p>参数：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>name</code></td><td>端口的名称</td></tr><tr><td><code>subnet_id</code></td><td>子网 ID</td></tr></tbody></table></li><li><p>鉴权：无</p></li><li><p>请求示例：<code>PUT /v1/ports/000006ac-ea63-4dd1-83e6-596e10a89366&quot;</code></p><div class="language-json" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;port001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;network_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;00016ac-ea63-42d1-83e6-8394819effa8&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>返回示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;code&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;msg&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;ok&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;data&quot;</span><span style="color:#D4D4D4;">: [</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;000006ac-ea63-4dd1-83e6-596e10a89366&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;name&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;port001&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;subnet_id&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;0008f705-d071-4cb9-ba69-eaf97560bd1a&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">&quot;ip&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;192.168.88.34&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  ]</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="3-项目设计步骤" tabindex="-1"><a class="header-anchor" href="#3-项目设计步骤" aria-hidden="true">#</a> 3. 项目设计步骤</h2><h3 id="31-项目结构" tabindex="-1"><a class="header-anchor" href="#31-项目结构" aria-hidden="true">#</a> 3.1 项目结构</h3><p>下面我们将介绍如何使用 Django 创建一个 RESTful 风格的 Web 应用。<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup></p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>各个组件说明：</p><ul><li>Url Patterns，将请求路由到具体处理的视图</li><li>View，处理 HTTP 请求并返回 <code>HTTPResponse</code> 对象</li><li>Serializer，序列化 / 反序列化模型数据</li><li>Models，模型，负责与数据库相关操作</li></ul><p>与常用的的 Django 应用相比，RESTful 风格接口仅仅是多使用了 Serializer 组件。</p><h3 id="32-创建项目" tabindex="-1"><a class="header-anchor" href="#32-创建项目" aria-hidden="true">#</a> 3.2 创建项目</h3><p>由于 Django 没有内置支持 RESTful 风格的接口，所以需要安装第三方库：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">pip</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">install</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">djangorestframework</span></span>
<span class="line"></span></code></pre></div><p>我们创建示例项目：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">django-admin</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">startproject</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">controller</span></span>
<span class="line"></span></code></pre></div><p>打开 <code>mysite/settings.py</code>，然后加入框架配置：</p><div class="language-python" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">INSTALLED_APPS = [</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&#39;rest_framework&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span></code></pre></div><p>新建示例应用：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">cd</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">mysite</span></span>
<span class="line"><span style="color:#DCDCAA;">python</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">manage.py</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">startapp</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">netcontroller</span></span>
<span class="line"></span></code></pre></div><p>和上面步骤一样，将 <code>&#39;netcontroller.apps.NetcontrollerConfig&#39;</code> 加入到 <code>INSTALLED_APPS</code> 配置中。</p><p>可以将时区和语言改为中文、北京时间，修改 <code>controller/settings.py</code> 下的配置：</p><div class="language-python" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">LANGUAGE_CODE = </span><span style="color:#CE9178;">&#39;zh-hans&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">TIME_ZONE = </span><span style="color:#CE9178;">&#39;Asia/Shanghai&#39;</span></span>
<span class="line"></span></code></pre></div><h3 id="33-定义模型" tabindex="-1"><a class="header-anchor" href="#33-定义模型" aria-hidden="true">#</a> 3.3 定义模型</h3><p>在 <code>netcontroller/models.py</code> 中添加 <code>Network</code> 类：<sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> uuid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.db </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> models</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Network</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">models</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">Model</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">id</span><span style="color:#D4D4D4;"> = models.UUIDField(</span><span style="color:#9CDCFE;">primary_key</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">default</span><span style="color:#D4D4D4;">=uuid.uuid4, </span><span style="color:#9CDCFE;">editable</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    name = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">64</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    availability_zone_hints = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    status = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">default</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;INACTIVE&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Meta</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        constraints = [</span></span>
<span class="line"><span style="color:#D4D4D4;">            models.UniqueConstraint(</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">fields</span><span style="color:#D4D4D4;">=[</span><span style="color:#CE9178;">&#39;availability_zone_hints&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;name&#39;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;zone_name_unique&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"><span style="color:#D4D4D4;">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">__str__</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">.name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Subnet</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">models</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">Model</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">id</span><span style="color:#D4D4D4;"> = models.UUIDField(</span><span style="color:#9CDCFE;">primary_key</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">default</span><span style="color:#D4D4D4;">=uuid.uuid4, </span><span style="color:#9CDCFE;">editable</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    name = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">64</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    cidr = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">64</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    network_id = models.ForeignKey(Network, </span><span style="color:#9CDCFE;">on_delete</span><span style="color:#D4D4D4;">=models.CASCADE)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Meta</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        constraints = [</span></span>
<span class="line"><span style="color:#D4D4D4;">            models.UniqueConstraint(</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">fields</span><span style="color:#D4D4D4;">=[</span><span style="color:#CE9178;">&#39;cidr&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;network_id&#39;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;cidr_network_id_unique&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"><span style="color:#D4D4D4;">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">__str__</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">) -&gt; </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;Port&lt;</span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">: </span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">&gt;&#39;</span><span style="color:#D4D4D4;">.format(</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">.name,</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">.cidr</span></span>
<span class="line"><span style="color:#D4D4D4;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Port</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">models</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">Model</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">id</span><span style="color:#D4D4D4;"> = models.UUIDField(</span><span style="color:#9CDCFE;">primary_key</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">default</span><span style="color:#D4D4D4;">=uuid.uuid4, </span><span style="color:#9CDCFE;">editable</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    name = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    mac = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">default</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">null</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    ip = models.CharField(</span><span style="color:#9CDCFE;">max_length</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    subnet_id = models.ForeignKey(Subnet, </span><span style="color:#9CDCFE;">on_delete</span><span style="color:#D4D4D4;">=models.CASCADE)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Meta</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        constraints = [</span></span>
<span class="line"><span style="color:#D4D4D4;">            models.UniqueConstraint(</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">fields</span><span style="color:#D4D4D4;">=[</span><span style="color:#CE9178;">&#39;ip&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;ip_subnet_id_unique&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"><span style="color:#D4D4D4;">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">__str__</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">) -&gt; </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;Port&lt;</span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">: </span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">&gt;&#39;</span><span style="color:#D4D4D4;">.format(</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">.name,</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">.ip</span></span>
<span class="line"><span style="color:#D4D4D4;">        )</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后执行数据迁移：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">python</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">manage.py</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">makemigrations</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">netcontroller</span></span>
<span class="line"></span></code></pre></div><p>这时数据库就会将表创建完成。</p><div class="hint-container tip"><p class="hint-container-title">如何使用 UUID 作为主键？</p><p>如果你在定义模型时没有显式的指定主键，那么 Django 会为你定义一个自增的 <code>id</code> 主键，相当于：</p><div class="language-python" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.db </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> models</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SomeModel</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">models</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">Model</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">id</span><span style="color:#D4D4D4;"> = models.AutoField(</span><span style="color:#9CDCFE;">primary_key</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre></div><p>这个 <code>id</code> 主键从 <code>1</code> 开始计数，每有一条新的数据则加一，保证了主键不重复。</p><p>下面是使用 UUID 定义主键 ID：</p><div class="language-python" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> uuid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.db </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> models</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SomeModel</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">models</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">Model</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">id</span><span style="color:#D4D4D4;"> = models.UUIDField(</span><span style="color:#9CDCFE;">primary_key</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">default</span><span style="color:#D4D4D4;">=uuid.uuid1, </span><span style="color:#9CDCFE;">editable</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre></div><p>关于库 <code>uuid</code> 的用法可以参考 <a href="https://docs.python.org/zh-cn/3/library/uuid.html" target="_blank" rel="noopener noreferrer">Python 标准库：<code>uuid</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>。</p></div><h3 id="34-创建序列化类" tabindex="-1"><a class="header-anchor" href="#34-创建序列化类" aria-hidden="true">#</a> 3.4 创建序列化类</h3><p>需要创建不同的 <code>Serializer</code> 类来管理序列化 / 反序列化 JSON 数据。目标类需要继承至 <code>rest_framework.serializers.ModelSerializer</code>。父类将自动获取字段集合和验证器。新建 <code>netcontroller/serializers.py</code> 文件：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.http.response </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> JsonResponse</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> rest_framework </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> serializers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> .models </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> Network, Port, Subnet</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">json_success</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;ok&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, **</span><span style="color:#9CDCFE;">kwargs</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    将数据序列化为 JSON 格式，并返回</span></span>
<span class="line"><span style="color:#CE9178;">    @param `data`: 可序列化的对象</span></span>
<span class="line"><span style="color:#CE9178;">    @param `error_msg`: `str` 错误信息</span></span>
<span class="line"><span style="color:#CE9178;">    @return: `HttpResponse`</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    res_data = {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;code&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;msg&#39;</span><span style="color:#D4D4D4;">: error_msg,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;data&#39;</span><span style="color:#D4D4D4;">: data,</span></span>
<span class="line"><span style="color:#D4D4D4;">        **kwargs</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> JsonResponse(res_data, </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=status, </span><span style="color:#9CDCFE;">safe</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">json_error</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">code</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;error&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">400</span><span style="color:#D4D4D4;">, **</span><span style="color:#9CDCFE;">kwargs</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    将错误信息序列化为 JSON 格式，并返回</span></span>
<span class="line"><span style="color:#CE9178;">    @param `code`: `int` 错误代码</span></span>
<span class="line"><span style="color:#CE9178;">    @param `error_msg`: `str` 错误信息</span></span>
<span class="line"><span style="color:#CE9178;">    @param `status`: `int` 状态码</span></span>
<span class="line"><span style="color:#CE9178;">    @return: `HttpResponse`</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    res_data = {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;code&#39;</span><span style="color:#D4D4D4;">: code,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;msg&#39;</span><span style="color:#D4D4D4;">: error_msg,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;data&#39;</span><span style="color:#D4D4D4;">: data,</span></span>
<span class="line"><span style="color:#D4D4D4;">        **kwargs</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> JsonResponse(res_data, </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=status, </span><span style="color:#9CDCFE;">safe</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">NetworkSerializer</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">serializers</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">ModelSerializer</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Meta</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        model = Network</span></span>
<span class="line"><span style="color:#D4D4D4;">        fields = </span><span style="color:#CE9178;">&#39;__all__&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SubnetSerializer</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">serializers</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">ModelSerializer</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Meta</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        model = Subnet</span></span>
<span class="line"><span style="color:#D4D4D4;">        fields = </span><span style="color:#CE9178;">&#39;__all__&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">PortSerializer</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">serializers</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">ModelSerializer</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Meta</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        model = Port</span></span>
<span class="line"><span style="color:#D4D4D4;">        fields = </span><span style="color:#CE9178;">&#39;__all__&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>netcontroller</code> 文件夹下新建 <code>urls.py</code> 文件：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.urls </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> path</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> . </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> views</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">urlpatterns = [</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">, views.index, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;index&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;v1/networks/&#39;</span><span style="color:#D4D4D4;">, views.networks, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;networks&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;v1/networks/&lt;uuid:uuid&gt;/&#39;</span><span style="color:#D4D4D4;">, views.network_id, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;network_id&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;v1/subnets/&#39;</span><span style="color:#D4D4D4;">, views.subnets, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;subnets&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;v1/subnets/&lt;uuid:uuid&gt;/&#39;</span><span style="color:#D4D4D4;">, views.subnet_id, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;v1/ports/&#39;</span><span style="color:#D4D4D4;">, views.ports, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;ports&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;v1/ports/&lt;uuid:uuid&gt;/&#39;</span><span style="color:#D4D4D4;">, views.port_id, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;port_id&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">如何匹配含有 UUID 路径？</p><p><code>path()</code> 默认能接受下面几种参数：<sup class="footnote-ref"><a href="#footnote3">[3]</a><a class="footnote-anchor" id="footnote-ref3"></a></sup></p><ol><li><code>str</code>：匹配除路径分隔符 <code>&#39;/&#39;</code> 之外的非空字符串</li><li><code>int</code>：匹配零或正整数</li><li><code>slug</code>：匹配由 ASCII 字母、数字、连字符、下划线字符组成的字符串，例如，<code>&#39;building-your-1st-django-site&#39;</code></li><li><code>uuid</code>：匹配格式化的 UUID，如 <code>&#39;075194d3-6885-417e-a8a8-6c931e272f00&#39;</code></li></ol><p>这里只需使用 <code>&lt;uuid:id&gt;</code> 即可。</p><p><code>path()</code> 也可以自定义参数匹配类型。此外，还有一种方法，可以在需要正则表达式的情况下使用：</p><div class="language-python" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.urls </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> include, re_path</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">urlpatterns = [</span></span>
<span class="line"><span style="color:#D4D4D4;">    re_path(</span><span style="color:#569CD6;">r</span><span style="color:#D16969;">&#39;^index/$&#39;</span><span style="color:#D4D4D4;">, views.index, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;index&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    re_path(</span><span style="color:#569CD6;">r</span><span style="color:#D16969;">&#39;^bio/</span><span style="color:#CE9178;">(</span><span style="color:#569CD6;">?P&lt;username&gt;</span><span style="color:#D16969;">\w</span><span style="color:#D7BA7D;">+</span><span style="color:#CE9178;">)</span><span style="color:#D16969;">/$&#39;</span><span style="color:#D4D4D4;">, views.bio, </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;bio&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    re_path(</span><span style="color:#569CD6;">r</span><span style="color:#D16969;">&#39;^blog/&#39;</span><span style="color:#D4D4D4;">, include(</span><span style="color:#CE9178;">&#39;blog.urls&#39;</span><span style="color:#D4D4D4;">)),</span></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span></code></pre></div><p><code>re_path()</code> 支持使用正则表达式来匹配。详情参考 <a href="https://docs.djangoproject.com/en/4.0/ref/urls/" target="_blank" rel="noopener noreferrer">Django：<code>urls</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>。</p></div><p>把 APP 的路由添加到项目的 <code>urlpatterns</code> 中：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.contrib </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> admin</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.urls </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> include, path</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">urlpatterns = [</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;admin/&#39;</span><span style="color:#D4D4D4;">, admin.site.urls),</span></span>
<span class="line"><span style="color:#D4D4D4;">    path(</span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">, include(</span><span style="color:#CE9178;">&#39;netcontroller.urls&#39;</span><span style="color:#D4D4D4;">)),</span></span>
<span class="line"><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">page404 = </span><span style="color:#CE9178;">&#39;netcontroller.views.global_404&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">page500 = </span><span style="color:#CE9178;">&#39;netcontroller.views.global_500&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">handler404 = page404</span></span>
<span class="line"><span style="color:#D4D4D4;">handler500 = page500</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="35-编写-api-视图" tabindex="-1"><a class="header-anchor" href="#35-编写-api-视图" aria-hidden="true">#</a> 3.5 编写 API 视图</h3><p>编写 <code>netcontroller/views.py</code>：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.db </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> models</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.http </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> HttpRequest, HttpResponse</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> django.views </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> View</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> rest_framework </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> serializers, status</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> rest_framework.decorators </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> api_view</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> rest_framework.parsers </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> JSONParser</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> .models </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> Network, Port, Subnet</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> .serializers </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> (NetworkSerializer, PortSerializer, SubnetSerializer,</span></span>
<span class="line"><span style="color:#D4D4D4;">                          json_error, json_success)</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> .utils </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> allocate_ip, allocate_ip_many, compute_ips, valid_cidr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">@api_view</span><span style="color:#D4D4D4;">([</span><span style="color:#CE9178;">&#39;GET&#39;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">index</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest) -&gt; HttpResponse:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot; 测试接口 &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_success(request.GET, </span><span style="color:#CE9178;">&#39;Hello, World!&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">basic_view_factory</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">model</span><span style="color:#D4D4D4;">: type[models.Model], </span><span style="color:#9CDCFE;">serializer</span><span style="color:#D4D4D4;">: type[serializers.Serializer]):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    基础视图工厂，支持 `GET`、`POST`</span></span>
<span class="line"><span style="color:#CE9178;">    @param `model`: 模型类</span></span>
<span class="line"><span style="color:#CE9178;">    @param `serializer`: 序列化类</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CE9178;">    视图工厂使用闭包机制复用代码</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">_C</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">View</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">        基础视图</span></span>
<span class="line"><span style="color:#CE9178;">        &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">http_method_not_allowed</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest, *</span><span style="color:#9CDCFE;">args</span><span style="color:#D4D4D4;">, **</span><span style="color:#9CDCFE;">kwargs</span><span style="color:#D4D4D4;">) -&gt; HttpResponse:</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;405 METHOD_NOT_ALLOWED&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=status.HTTP_405_METHOD_NOT_ALLOWED</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">get</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest):</span></span>
<span class="line"><span style="color:#D4D4D4;">            limit = request.GET.get(</span><span style="color:#CE9178;">&#39;limit&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            offset = request.GET.get(</span><span style="color:#CE9178;">&#39;offset&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            network_id = request.GET.get(</span><span style="color:#CE9178;">&#39;network_id&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            subnet_id = request.GET.get(</span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            query = model.objects</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> model == Subnet:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> network_id </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    query = query.filter(</span><span style="color:#9CDCFE;">network_id</span><span style="color:#D4D4D4;">=network_id)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">elif</span><span style="color:#D4D4D4;"> model == Port:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> subnet_id </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    query = query.filter(</span><span style="color:#9CDCFE;">subnet_id</span><span style="color:#D4D4D4;">=subnet_id)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> offset </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                offset = </span><span style="color:#B5CEA8;">0</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> limit </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                curr_model = query.all()[</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(offset):]</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                curr_model = query.values()[</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(offset):</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(limit)]</span></span>
<span class="line"><span style="color:#D4D4D4;">            ser = serializer(curr_model, </span><span style="color:#9CDCFE;">many</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_success(ser.data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">post</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest):</span></span>
<span class="line"><span style="color:#D4D4D4;">            data = JSONParser().parse(request)</span></span>
<span class="line"><span style="color:#D4D4D4;">            ser = serializer(</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">=data)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#6A9955;"># CIDR 验证器</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> model == Subnet:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> valid_cidr(data[</span><span style="color:#CE9178;">&#39;cidr&#39;</span><span style="color:#D4D4D4;">]):</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;Invalid CIDR&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#6A9955;"># Port 下分配 IP</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> model == Port:</span></span>
<span class="line"><span style="color:#D4D4D4;">                cidr = Subnet.objects.get(</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">=data[</span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">]).cidr</span></span>
<span class="line"><span style="color:#D4D4D4;">                allocated_ips = (</span></span>
<span class="line"><span style="color:#D4D4D4;">                    x.ip </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> x </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> Port.objects.filter(</span><span style="color:#9CDCFE;">subnet_id</span><span style="color:#D4D4D4;">=data[</span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">                )</span></span>
<span class="line"><span style="color:#D4D4D4;">                ip = allocate_ip(cidr, allocated_ips)</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> ip:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;IP 地址已被分配完&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    data[</span><span style="color:#CE9178;">&#39;ip&#39;</span><span style="color:#D4D4D4;">] = ip</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> ser.is_valid():</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    ser.save()</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">except</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;数据重复或异常，不满足约束，无法创建&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_success(ser.data, </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=status.HTTP_201_CREATED)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(ser.errors)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> _C</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">include_id_factory</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">model</span><span style="color:#D4D4D4;">: type[models.Model], </span><span style="color:#9CDCFE;">serializer</span><span style="color:#D4D4D4;">: type[serializers.Serializer]):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    视图工厂，支持使用 ID 获取对象</span></span>
<span class="line"><span style="color:#CE9178;">    @param `model`: 模型类</span></span>
<span class="line"><span style="color:#CE9178;">    @param `serializer`: 序列化类</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CE9178;">    视图工厂使用闭包机制复用代码</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">_C</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">View</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">        包含 ID 的请求视图</span></span>
<span class="line"><span style="color:#CE9178;">        &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">_get_query_model</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">model_id</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">            获取查询模型</span></span>
<span class="line"><span style="color:#CE9178;">            &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">            query_model = model.objects.filter(</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">=model_id)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> query_model:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;404 NOT_FOUND&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=status.HTTP_404_NOT_FOUND</span></span>
<span class="line"><span style="color:#D4D4D4;">                ), </span><span style="color:#569CD6;">None</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> query_model, query_model.first()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">get</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest, **</span><span style="color:#9CDCFE;">kwargs</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">            model_id = kwargs.get(</span><span style="color:#CE9178;">&#39;uuid&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            query_model, curr_model = </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">._get_query_model(model_id)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> curr_model </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> query_model</span></span>
<span class="line"><span style="color:#D4D4D4;">            ser = serializer(query_model, </span><span style="color:#9CDCFE;">many</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#6A9955;"># 如果是子网，还需要计算有多少可用地址</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> model == Subnet:</span></span>
<span class="line"><span style="color:#D4D4D4;">                occupied = (</span></span>
<span class="line"><span style="color:#D4D4D4;">                    port.ip </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> port </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> Port.objects.filter(</span><span style="color:#9CDCFE;">subnet_id</span><span style="color:#D4D4D4;">=curr_model.id)</span></span>
<span class="line"><span style="color:#D4D4D4;">                )</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_success(</span></span>
<span class="line"><span style="color:#D4D4D4;">                    ser.data,</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#9CDCFE;">available_ip</span><span style="color:#D4D4D4;">=compute_ips(curr_model.cidr, occupied)</span></span>
<span class="line"><span style="color:#D4D4D4;">                )</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_success(ser.data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest, **</span><span style="color:#9CDCFE;">kwargs</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">            model_id = kwargs.get(</span><span style="color:#CE9178;">&#39;uuid&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            query_model, curr_model = </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">._get_query_model(model_id)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> curr_model </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> query_model</span></span>
<span class="line"><span style="color:#D4D4D4;">            data = JSONParser().parse(request)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#6A9955;"># 子网</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> model == Subnet:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> valid_cidr(data[</span><span style="color:#CE9178;">&#39;cidr&#39;</span><span style="color:#D4D4D4;">]):</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;Invalid CIDR&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;"># 如果更改了 CIDR，需要重新分配 IP</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;"># ========================================================</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;"># 注意此处需要事务一致性，修改时不可以并发写入</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;"># ========================================================</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> curr_model.cidr != data[</span><span style="color:#CE9178;">&#39;cidr&#39;</span><span style="color:#D4D4D4;">]:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    occupied_number = Port.objects.filter(</span><span style="color:#9CDCFE;">subnet_id</span><span style="color:#D4D4D4;">=curr_model.id).count()</span></span>
<span class="line"><span style="color:#D4D4D4;">                    new_cird_number = compute_ips(data[</span><span style="color:#CE9178;">&#39;cidr&#39;</span><span style="color:#D4D4D4;">], [])[</span><span style="color:#CE9178;">&#39;available&#39;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> new_cird_number &lt; occupied_number:</span></span>
<span class="line"><span style="color:#D4D4D4;">                        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;无法满足 Port 的 IP 分配&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                        ip_pool = allocate_ip_many(data[</span><span style="color:#CE9178;">&#39;cidr&#39;</span><span style="color:#D4D4D4;">], new_cird_number)</span></span>
<span class="line"><span style="color:#D4D4D4;">                        </span><span style="color:#6A9955;"># 重新分配 IP</span></span>
<span class="line"><span style="color:#D4D4D4;">                        </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> ip, port </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">zip</span><span style="color:#D4D4D4;">(ip_pool, Port.objects.filter(</span><span style="color:#9CDCFE;">subnet_id</span><span style="color:#D4D4D4;">=curr_model.id)):</span></span>
<span class="line"><span style="color:#D4D4D4;">                            port.ip = ip</span></span>
<span class="line"><span style="color:#D4D4D4;">                            port.save()</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#6A9955;"># Port</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> model == Port:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;"># 当 subnet_id 改变时重新分配 IP</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> curr_model.subnet_id != data[</span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">]:</span></span>
<span class="line"><span style="color:#D4D4D4;">                    cidr = Subnet.objects.get(</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">=data[</span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">]).cidr</span></span>
<span class="line"><span style="color:#D4D4D4;">                    allocated_ips = (</span></span>
<span class="line"><span style="color:#D4D4D4;">                        x.ip </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> x </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> Port.objects.filter(</span><span style="color:#9CDCFE;">subnet_id</span><span style="color:#D4D4D4;">=data[</span><span style="color:#CE9178;">&#39;subnet_id&#39;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">                    )</span></span>
<span class="line"><span style="color:#D4D4D4;">                    ip = allocate_ip(cidr, allocated_ips)</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> ip:</span></span>
<span class="line"><span style="color:#D4D4D4;">                        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;IP 地址已被分配完&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                        data[</span><span style="color:#CE9178;">&#39;ip&#39;</span><span style="color:#D4D4D4;">] = ip</span></span>
<span class="line"><span style="color:#D4D4D4;">            ser = serializer(curr_model, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">=data)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> ser.is_valid():</span></span>
<span class="line"><span style="color:#D4D4D4;">                ser.save()</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_success(ser.data)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(ser.errors)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">delete</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">self</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest, **</span><span style="color:#9CDCFE;">kwargs</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">            model_id = kwargs.get(</span><span style="color:#CE9178;">&#39;uuid&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">            query_model, curr_model = </span><span style="color:#569CD6;">self</span><span style="color:#D4D4D4;">._get_query_model(model_id)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> curr_model </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> query_model</span></span>
<span class="line"><span style="color:#D4D4D4;">            affected_lines = curr_model.delete()[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_success(</span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">affected</span><span style="color:#D4D4D4;">=affected_lines)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> _C</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">global_404</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest, </span><span style="color:#9CDCFE;">exception</span><span style="color:#D4D4D4;">) -&gt; HttpResponse:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    全局 404 页面</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;404 NOT_FOUND&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=status.HTTP_404_NOT_FOUND</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">global_500</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">request</span><span style="color:#D4D4D4;">: HttpRequest) -&gt; HttpResponse:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    全局 500 页面</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> json_error(</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">error_msg</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;500 INTERNAL_SERVER_ERROR&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;">=status.HTTP_500_INTERNAL_SERVER_ERROR</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">networks = basic_view_factory(Network, NetworkSerializer).as_view()</span></span>
<span class="line"><span style="color:#D4D4D4;">subnets = basic_view_factory(Subnet, SubnetSerializer).as_view()</span></span>
<span class="line"><span style="color:#D4D4D4;">ports = basic_view_factory(Port, PortSerializer).as_view()</span></span>
<span class="line"><span style="color:#D4D4D4;">network_id = include_id_factory(Network, NetworkSerializer).as_view()</span></span>
<span class="line"><span style="color:#D4D4D4;">subnet_id = include_id_factory(Subnet, SubnetSerializer).as_view()</span></span>
<span class="line"><span style="color:#D4D4D4;">port_id = include_id_factory(Port, PortSerializer).as_view()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后是分配 IP 和检查 IP 地址的算法，在 <code>netcontroller/utils.py</code> 下面：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> ipaddress</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> typing </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> Iterable</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">allocate_ip</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">cidr</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">allocated_ips</span><span style="color:#D4D4D4;">: Iterable[</span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">]):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    通过 CIDR 分配 IP 地址</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    allocated_ips_set = </span><span style="color:#4EC9B0;">set</span><span style="color:#D4D4D4;">(allocated_ips)</span></span>
<span class="line"><span style="color:#D4D4D4;">    ip_network = ipaddress.ip_network(cidr)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> ip </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> ip_network.hosts():</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> ip.compressed </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">in</span><span style="color:#D4D4D4;"> allocated_ips_set:</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> ip.compressed</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">allocate_ip_many</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">cidr</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">n</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">) -&gt; Iterable[</span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">]:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    通过 CIDR 分配多个 IP 地址</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    ip_network = ipaddress.ip_network(cidr)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">        (ip_network.network_address + x).compressed</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> x </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">range</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, n + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">compute_ips</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">cidr</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">occupied</span><span style="color:#D4D4D4;">: Iterable[</span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">]):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    计算子网可用信息</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    ip_network = ipaddress.ip_network(cidr)</span></span>
<span class="line"><span style="color:#D4D4D4;">    total = ip_network.num_addresses</span></span>
<span class="line"><span style="color:#D4D4D4;">    occupied_set = </span><span style="color:#4EC9B0;">set</span><span style="color:#D4D4D4;">(occupied)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;"># 不包括广播地址和网络地址</span></span>
<span class="line"><span style="color:#D4D4D4;">    available = total - </span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(occupied_set) - </span><span style="color:#B5CEA8;">2</span></span>
<span class="line"><span style="color:#D4D4D4;">    ips = list[dict[</span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">, </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">]]()</span></span>
<span class="line"><span style="color:#D4D4D4;">    flag = </span><span style="color:#569CD6;">False</span></span>
<span class="line"><span style="color:#D4D4D4;">    start = </span><span style="color:#CE9178;">&#39;&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> x </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">range</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, total + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">        curr = ip_network.network_address + x</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> curr.compressed </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">in</span><span style="color:#D4D4D4;"> occupied_set:</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> flag:</span></span>
<span class="line"><span style="color:#D4D4D4;">                start = curr.compressed</span></span>
<span class="line"><span style="color:#D4D4D4;">                flag = </span><span style="color:#569CD6;">True</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> flag:</span></span>
<span class="line"><span style="color:#D4D4D4;">                ips.append({</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#CE9178;">&#39;start&#39;</span><span style="color:#D4D4D4;">: start,</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#CE9178;">&#39;end&#39;</span><span style="color:#D4D4D4;">: (curr - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">).compressed</span></span>
<span class="line"><span style="color:#D4D4D4;">                })</span></span>
<span class="line"><span style="color:#D4D4D4;">                flag = </span><span style="color:#569CD6;">False</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> flag:</span></span>
<span class="line"><span style="color:#D4D4D4;">        ips.append({</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#CE9178;">&#39;start&#39;</span><span style="color:#D4D4D4;">: start,</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#CE9178;">&#39;end&#39;</span><span style="color:#D4D4D4;">: (ip_network.broadcast_address - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">).compressed</span></span>
<span class="line"><span style="color:#D4D4D4;">        })</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;total&#39;</span><span style="color:#D4D4D4;">: total,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;available&#39;</span><span style="color:#D4D4D4;">: available,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;ips&#39;</span><span style="color:#D4D4D4;">: ips,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&#39;netmask&#39;</span><span style="color:#D4D4D4;">: ip_network.netmask.compressed</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">valid_cidr</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">cidr</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">) -&gt; </span><span style="color:#4EC9B0;">bool</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    检查 CIDR 是否合法</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        network = ipaddress.ip_network(cidr, </span><span style="color:#9CDCFE;">strict</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">bool</span><span style="color:#D4D4D4;">(network)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">except</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">ValueError</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">valid_ip</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">ip</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">) -&gt; </span><span style="color:#4EC9B0;">bool</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">    检查 IP 是否合法</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        ip_address = ipaddress.ip_address(ip)</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">bool</span><span style="color:#D4D4D4;">(ip_address)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">except</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">ValueError</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">False</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意事项</p><ul><li>在编写视图中使用装饰器 <code>@api_view</code> 限定请求方法</li><li>使用 <code>JsonResponse</code> 将字典序列化为字符串并返回结果</li><li>使用 <code>JSONParser().parse(request)</code> 方法从表单中反序列化，该方法的返回值为字典</li></ul></div><p>下面启动应用进行测试即可：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">python</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">manage.py</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">runserver</span></span>
<span class="line"></span></code></pre></div><h2 id="附录-a什么是-cidr" tabindex="-1"><a class="header-anchor" href="#附录-a什么是-cidr" aria-hidden="true">#</a> 附录 A：什么是 CIDR</h2><p>将 IP 地址分为 A 类、B 类、C 类后，会造成 IP 地址的部分浪费。例如，一些连续的 IP 地址，一部分属于 A 类地址，另一部分属于 B 类地址。为了使这些地址聚合以方便管理，出现了 CIDR（无类域间路由）。<sup class="footnote-ref"><a href="#footnote4">[4]</a><a class="footnote-anchor" id="footnote-ref4"></a></sup></p><p>无类域间路由（Classless Inter-Domain Routing，CIDR）可以将路由集中起来，在路由表中更灵活地定义地址。它不区分 A 类、B 类、C 类地址，而是使用 CIDR 前缀的值指定地址中作为网络 ID 的位数。</p><p>这个前缀可以位于地址空间的任何位置，让管理者能够以更灵活的方式定义子网，以简便的形式指定地址中网络 ID 部分和主机 ID 部分。</p><p>CIDR 标记使用一个斜线 <code>/</code> 分隔符，后面跟一个十进制数值表示地址中网络部分所占的位数。例如，<code>205.123.196.183/25</code> 中的 <code>25</code> 表示地址中 <code>25</code> 位用于网络 ID，相应的掩码为 <code>255.255.255.128</code>。</p><p>使用 <code>netwox</code> 工具列出有多少可用 IP：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">netwox</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">213</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-i</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">192.168</span><span style="color:#CE9178;">.1.32/27</span></span>
<span class="line"></span></code></pre></div><p>输出：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">192.168.1.32</span></span>
<span class="line"><span style="color:#DCDCAA;">192.168.1.33</span></span>
<span class="line"><span style="color:#DCDCAA;">192.168.1.34</span></span>
<span class="line"><span style="color:#DCDCAA;">...</span></span>
<span class="line"><span style="color:#DCDCAA;">...</span></span>
<span class="line"><span style="color:#DCDCAA;">192.168.1.61</span></span>
<span class="line"><span style="color:#DCDCAA;">192.168.1.62</span></span>
<span class="line"><span style="color:#DCDCAA;">192.168.1.63</span></span>
<span class="line"></span></code></pre></div><p>获得掩码和地址段：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">netwox</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">24</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-i</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">192.168</span><span style="color:#CE9178;">.1.32/27</span></span>
<span class="line"></span></code></pre></div><p>输出：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">192.168.1.32-192.168.1.63</span></span>
<span class="line"><span style="color:#DCDCAA;">192.168.1.32/27</span></span>
<span class="line"><span style="color:#DCDCAA;">192.168.1.32/255.255.255.224</span></span>
<span class="line"><span style="color:#DCDCAA;">...</span></span>
<span class="line"></span></code></pre></div><p>你可以使用 <a href="https://purecalculators.com/ip-subnet-calculator" target="_blank" rel="noopener noreferrer">在线 CIDR 计算器<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> 来计算。</p><h2 id="附录-bpython-计算可用-ip-信息" tabindex="-1"><a class="header-anchor" href="#附录-bpython-计算可用-ip-信息" aria-hidden="true">#</a> 附录 B：Python 计算可用 IP 信息</h2><p>那么 Python 如何计算 CIDR 的可用 IP 数和相关信息呢？这里仅讨论 IPv4。</p><p>对于标准库，Python 提供了 <code>ipaddress</code> 来计算 IP 信息：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> ipaddress</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">cidr = </span><span style="color:#CE9178;">&#39;192.168.1.32/27&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">network = ipaddress.IPv4Network(cidr)</span></span>
<span class="line"><span style="color:#D4D4D4;">available_ips = </span><span style="color:#4EC9B0;">list</span><span style="color:#D4D4D4;">(ip.compressed </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> ip </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> network.hosts())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;可用 IP 数量:&#39;</span><span style="color:#D4D4D4;">, network.num_addresses)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;网络地址 IP:&#39;</span><span style="color:#D4D4D4;">, network.network_address)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;子网掩码:&#39;</span><span style="color:#D4D4D4;">, network.netmask)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;所有可用 IP:&#39;</span><span style="color:#D4D4D4;">, available_ips)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;广播地址:&#39;</span><span style="color:#D4D4D4;">, network.broadcast_address)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：可用地址数组（即 <code>network.hosts()</code>）内 <strong>不包含网络地址和广播地址</strong>，这里的广播地址是指掩码运算后的部分全为 <code>1</code> 的 IP 地址。</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>手把手教你用 Django 实现 RESTful 接口，知乎，<a href="https://zhuanlan.zhihu.com/p/356405945" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/356405945<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p>Django 知识库：UUID 作为模型主键，知乎，<a href="https://zhuanlan.zhihu.com/p/139525123" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/139525123<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li><li id="footnote3" class="footnote-item"><p>Django 知识库：<code>path()</code> 路径映射，知乎，<a href="https://zhuanlan.zhihu.com/p/139523421" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/139523421<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref3" class="footnote-backref">↩︎</a></p></li><li id="footnote4" class="footnote-item"><p>CIDR（无类域间路由）是什么，C 语言中文网，<a href="http://c.biancheng.net/view/6409.html" target="_blank" rel="noopener noreferrer">http://c.biancheng.net/view/6409.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref4" class="footnote-backref">↩︎</a></p></li></ol></section></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/Sun-ZhenXing/vuepress-python-notes//edit/main/docs/awesome/cloud-controller/index.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1006925066@qq.com">Sun-ZhenXing</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/vuepress-python-notes/assets/app-69c72c30.js" defer></script>
  </body>
</html>
